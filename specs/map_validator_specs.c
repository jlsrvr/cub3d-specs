#include "spec.h"

static void map_validator_test(char *describe, int returned, char *str_map_in, char *str_exp_map_out, int *sucess, int *failure)
{
	int response;
	char **map_in;
	char **exp_map_out;

	map_in = ft_split(str_map_in, '>');
	exp_map_out = ft_split(str_exp_map_out, '>');
	printf("<==== %s ====>\n", describe);
	response = map_validator(&map_in);
	if (response == returned)
		check_map(map_in, exp_map_out, sucess, failure);
	else
	{
		printf(RED "KO\n" RESET);
		printf("Expected = [%d]\n", returned);
		printf("Got      = [%d]\n", response);
	}
	free_map(map_in);
	free_map(exp_map_out);
	return ;
}

int main(void)
{
	char *map_in;
	char *exp_map_out;
	int sucess = 0;
	int failure = 0;

	map_in = "1111>1001>10W1>1111";
	exp_map_out = "1111>1001>10W1>1111";
	map_validator_test("Simple validation", 0, map_in, exp_map_out, &sucess, &failure);
	map_in = " 1111>1001>10W1>1111";
	exp_map_out = " 1111>1001 >10W1 >1111 ";
	map_validator_test("Simple validation and resize", 1, map_in, exp_map_out, &sucess, &failure);
	map_in = " 1111>   1001>10W1        >1111";
	exp_map_out = " 1111       >   1001     >10W1        >1111        ";
	map_validator_test("Less simple validation and resize", 1, map_in, exp_map_out, &sucess, &failure);
	map_in = "1101>1001>10W1>1111";
	exp_map_out = map_in;
	map_validator_test("Simple invalid map", 1, map_in, exp_map_out, &sucess, &failure);
	map_in = "1111>1000>10W1>1111";
	exp_map_out = map_in;
	map_validator_test("Missing a wall", 1, map_in, exp_map_out, &sucess, &failure);
	map_in = "111 111>1011101>10000W1>1111111";
	exp_map_out =  "1111111>1011101>10000W1>1111111";
	map_validator_test("Valid map with space on outside", 0, map_in, exp_map_out, &sucess, &failure);
	map_in = "11111111>10000001>10111101>101  101>101  1N1>111  111";
	exp_map_out =  "11111111>10000001>10111101>10111101>101111N1>11111111";
	map_validator_test("More complex valid map", 0, map_in, exp_map_out, &sucess, &failure);
	map_in = "        1111111111111111111111111>        1000000000110000000000001>        1011000001110000002000001>        1001000000000000000000001>111111111011000001110000000000001>100000000011000001110111111111111>11110111111111011100000010001>11110111111111011101010010001>11000000110101011100000010001>10002000000000001100000010001>10000000000000001101010010001>11000001110101011111011110N0111>11110111 1110101 101111010001>11111111 1111111 111111111111";
	exp_map_out = "111111111111111111111111111111111>111111111000000000110000000000001>111111111011000001110000002000001>111111111001000000000000000000001>111111111011000001110000000000001>100000000011000001110111111111111>111101111111110111000000100011111>111101111111110111010100100011111>110000001101010111000000100011111>100020000000000011000000100011111>100000000000000011010100100011111>11000001110101011111011110N011111>111101111111010111011110100011111>111111111111111111111111111111111";
	map_validator_test("Valid map found in pdf", 0, map_in, exp_map_out, &sucess, &failure);
	map_in = "11111111>10000001>10011101>101  101>101  1N1>111  111";
	exp_map_out = map_in;
	map_validator_test("Incomplet inside wall", 1, map_in, exp_map_out, &sucess, &failure);
	map_in = "11111111>10000001>10111101>101  101>100  1N1>111  111";
	exp_map_out = map_in;
	map_validator_test("Incomplet corridor", 1, map_in, exp_map_out, &sucess, &failure);
	map_in = "11111111>10000001>10111101>101  101>101  1N1>111";
	exp_map_out =  "11111111>10000001>10111101>101  101>101  1N1>111     ";
	map_validator_test("N instead of wall", 1, map_in, exp_map_out, &sucess, &failure);
	map_in = "1111>1001>1WW1>1111";
	exp_map_out = "1111>1001>1WW1>1111";
	map_validator_test("Simple map with two positions", 1, map_in, exp_map_out, &sucess, &failure);
	map_in = "1111>1001>1001>1111";
	exp_map_out = "1111>1001>1001>1111";
	map_validator_test("Simple map with no position", 1, map_in, exp_map_out, &sucess, &failure);
	map_in = "        1111111111111111111111111>        1000000000110000000N00001>        1011000001110000002000001>        1001000000000000000000001>11111111101100000111E000000000001>100000000011000001110111111111111>11110111111111011100000010001>11110111111111011101010010001>11000000110101011100000010001>10002000000000001100000010001>10000000000000001101010010001>11000001110101011111011110N0111>11110111 1110101 101111010001>11111111 1111111 111111111111";
	exp_map_out = "        1111111111111111111111111>        1000000000110000000N00001>        1011000001110000002000001>        1001000000000000000000001>11111111101100000111E000000000001>100000000011000001110111111111111>11110111111111011100000010001    >11110111111111011101010010001    >11000000110101011100000010001    >10002000000000001100000010001    >10000000000000001101010010001    >11000001110101011111011110N0111  >11110111 1110101 101111010001    >11111111 1111111 111111111111    ";
	map_validator_test("Map found in pdf but with added player positions", 1, map_in, exp_map_out, &sucess, &failure);
	map_in = "        1111111111111111111111111>        1000000000110000000000001>        1011000001110000002000001>        1001000000000000000000001>111111111011000001110000000000001>100000000011000001110111111111111>11110111111111011100000010001>11110111111111011101010010001>11000000110101011100000010001>10002000000000001100000010001>10000000000000001101010010001>1100000111010101111101111000111>11110111 1110101 101111010001>11111111 1111111 111111111111";
	exp_map_out = "        1111111111111111111111111>        1000000000110000000000001>        1011000001110000002000001>        1001000000000000000000001>111111111011000001110000000000001>100000000011000001110111111111111>11110111111111011100000010001    >11110111111111011101010010001    >11000000110101011100000010001    >10002000000000001100000010001    >10000000000000001101010010001    >1100000111010101111101111000111  >11110111 1110101 101111010001    >11111111 1111111 111111111111    ";
	map_validator_test("Map found in pdf but removed player positions", 1, map_in, exp_map_out, &sucess, &failure);
	map_in = "111111111>100000001>101111101>1N1   101>101   101>101   101>101111101>100000001>111111111";
	exp_map_out =  "111111111>100000001>101111101>1N1111101>101111101>101111101>101111101>100000001>111111111";
	map_validator_test("Hole inside valid map", 0, map_in, exp_map_out, &sucess, &failure);
	map_in = "111111111>100000001>100111101>1N1   101>101   101>101   101>101111101>100000001>111111111";
	exp_map_out = map_in;
	map_validator_test("Unclosed inner wall", 1, map_in, exp_map_out, &sucess, &failure);

	printf("\t%d success out of %d tests\n", sucess, (sucess + failure));
	return (0);
}
